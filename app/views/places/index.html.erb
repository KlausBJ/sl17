<p id='notice'><%= notice %></p>

<h1>Steder</h1>
<% p_names = [] %>
<% a_ids = [] %>
<% a_names = [] %>
<% a_tovholdere = [] %>
<% a_starttimes = [] %>
<% a_endtimes = [] %>
<% @places.each_with_index do |place,index| %>
  <% p_names[index] = place.name %>
  <% a_ids[index] = place.a_ids.split(',') %>
  <% a_names[index] = place.a_names.split(',') %>
  <% a_starttimes[index] = place.starttimes.split(',') %>
  <% a_endtimes[index] = place.endtimes.split(',') %>
  <% a_tovholdere[index] = place.tovholdere.split(',') %>
<% end %>


<% times = (start_time.to_i..end_time.to_i).to_a.in_groups_of(30.minutes).collect(&:first).
  collect { |t| Time.at(t).utc.to_time_of_day } %>

<% (0..6).each do |index| %>
<% day = Date.new(2017, 7, index + 8) %>

<% end %>

<table>
  <tr>
    <td>
    </td>
    <% (0..p_names.length - 1).each do |place| %>
      <td>
        <% p_names[place] %>
      </td>
    <% end %>
    </tr>
  <% times.each do |time| %>
      <% curr_time = day.at time %>
    <tr>
      <td>
        <%= "#{time.hour < 10 ? '0' : '' }#{time.hour}:#{time.min.zero? ? '00' : '30'}" %>
      </td>
      <% (0..p_names.length - 1).each do |place| %>
        if place.nuv_aktivitet.starttime == curr_time # aktivitet starter her
          <td>
            vis nuv_aktivitet
            <% rowspan[place] = nuv_aktivitet.endtime - nuv_aktivitet.starttime / 30.minutes %>
          </td>
        ellers # aktivitet eller ledig tid i gang
          <% if rowspan[place] > 0 %>
            <% rowspan[place] -= 1 %>
            hvis rowspan[place] == 0 && nuv_aktivitet.starttime < curr_time # hvis ledig tid er næste aktivitet allerede hentet
              næste aktivitet
  <% end %> # aktivitet slutter her
          <% else %> # ledig tid starter her
            <td>
              vis ledig tid
              <% rowspan[place] = nuv_aktivitet.starttime - curr_time / 30.minutes %>
            </td>
          <% end %> # ledig
        <% end %> # betinget visning
      <% end %> # kolonne
    </tr>
  <% end %> # time
</table>





<% days = (Date.new(2017, 7, 8)..Date.new(2017, 7, 14)) %>
<% last_column = p_names.length - 1 %>
<table>
  <thead>
    <tr>
      <%  %>
      <th>Navn</th>
      <th>Beskrivelse</th>
      <th>Begrænset</th>
      <th colspan='3'></th>
    </tr>
  </thead>

  <tbody>
    <% @places.each do |place| %>
      <tr>
        <td><%= place.name %></td>
        <td><%= place.description %></td>
        <td><%= place.limited %></td>
        <td><%= link_to 'Vis', place %></td>
        <td><%= link_to 'Rediger', edit_place_path(place) %></td>
        <td><%= link_to 'Slet', place, method: :delete, data: { confirm: 'Er du sikker?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'Nyt Sted', new_place_path %>
